(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();class I{constructor(t,e="about:home",s=""){this.id=t,this.webviewId=`webview-${t}`,this.title="New Tab",this.url=e,this.favicon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iIzQyODVGNCIgZD0iTTEyLDBDNS4zNzMsMCwwLDUuMzczLDAsMTJzNS4zNzMsMTIsMTIsMTJzMTItNS4zNzMsMTItMTJTMTguNjI3LDAsMTIsMHoiLz48L3N2Zz4=",this.groupId=s,this.canGoBack=!1,this.canGoForward=!1,this.isLoading=!1,this.isActive=!1,this.element=null,this.webview=null,this.container=null}createElements(){this.container=document.createElement("div"),this.container.id=`webview-container-${this.id}`,this.container.className="webview-container",this.container.style.display="none",this.webview=document.createElement("webview"),this.webview.id=this.webviewId,this.webview.src=this.url,this.webview.setAttribute("partition","persist:default"),this.webview.setAttribute("webpreferences","contextIsolation=yes,nodeIntegration=no"),this.container.appendChild(this.webview),document.getElementById("app").appendChild(this.container);const t=document.getElementById("tab-template");this.element=t.content.cloneNode(!0).firstElementChild,this.element.dataset.tabId=this.id,this.element.querySelector(".tab-title").textContent=this.title,this.element.querySelector(".tab-favicon").src=this.favicon;const e=this.element.querySelector(".tab-close");e.onclick=i=>{i.stopPropagation(),this.emit("close",this.id)},this.element.onclick=i=>{i.target!==e&&!e.contains(i.target)&&this.emit("activate",this.id)},this.element.draggable=!0,this.element.setAttribute("draggable","true"),this.element.addEventListener("dragstart",i=>{this.emit("dragStart",i,this.id)}),this.element.addEventListener("dragend",()=>{this.element.classList.remove("dragging")}),this.element.addEventListener("drag",i=>{i.stopPropagation()}),document.getElementById("tabs").insertBefore(this.element,document.getElementById("new-tab"))}updateUI(){if(!this.element)return;const t=this.element.querySelector(".tab-title"),e=this.element.querySelector(".tab-favicon");t.textContent=this.title||"New Tab",e.src=this.favicon,this.isActive?(this.element.classList.add("active"),this.container.style.display="block",document.title=`${this.title} - Decentralized Browser`):(this.element.classList.remove("active"),this.container.style.display="none"),this.isLoading?this.element.classList.add("loading"):this.element.classList.remove("loading")}destroy(){this.element&&this.element.parentNode&&this.element.remove(),this.container&&this.container.parentNode&&this.container.remove()}on(t,e){this._events||(this._events={}),this._events[t]||(this._events[t]=[]),this._events[t].push(e)}emit(t,...e){if(!(!this._events||!this._events[t]))for(const s of this._events[t])s(...e)}}class L{constructor(t,e="New Group",s="#4a90e2"){this.id=t,this.name=e,this.color=s,this.tabIds=new Set,this.collapsed=!1,this.element=null,this.headerElement=null,this.tabsContainer=null}createElements(){this.element=document.createElement("div"),this.element.className="tab-group",this.element.dataset.groupId=this.id,this.element.style.borderLeft=`3px solid ${this.color}`,this.headerElement=document.createElement("div"),this.headerElement.className="tab-group-header";const t=document.createElement("button");t.className="tab-group-toggle",t.innerHTML="‚ñº",t.onclick=()=>this.toggle();const e=document.createElement("span");e.className="tab-group-name",e.textContent=this.name,e.contentEditable=!0,e.onblur=r=>this.rename(r.target.textContent),e.onkeydown=r=>{r.key==="Enter"&&(r.preventDefault(),r.target.blur())};const s=document.createElement("span");s.className="tab-group-count",s.textContent=this.tabIds.size;const i=document.createElement("button");return i.className="tab-group-close",i.innerHTML="√ó",i.onclick=r=>{r.stopPropagation(),this.emit("close",this.id)},this.headerElement.appendChild(t),this.headerElement.appendChild(e),this.headerElement.appendChild(s),this.headerElement.appendChild(i),this.tabsContainer=document.createElement("div"),this.tabsContainer.className="tab-group-tabs",this.element.appendChild(this.headerElement),this.element.appendChild(this.tabsContainer),this.element}addTab(t){this.tabIds.has(t)||(this.tabIds.add(t),this.updateCount(),this.emit("tabAdded",{groupId:this.id,tabId:t}))}removeTab(t){this.tabIds.delete(t)&&(this.updateCount(),this.emit("tabRemoved",{groupId:this.id,tabId:t}))}toggle(){this.collapsed=!this.collapsed,this.element.classList.toggle("collapsed",this.collapsed),this.emit("toggle",{groupId:this.id,collapsed:this.collapsed})}rename(t){if(t&&t!==this.name){const e=this.name;this.name=t,this.emit("rename",{groupId:this.id,oldName:e,newName:t})}}setColor(t){t!==this.color&&(this.color=t,this.element.style.borderLeftColor=t,this.emit("colorChange",{groupId:this.id,color:t}))}updateCount(){var e;const t=(e=this.headerElement)==null?void 0:e.querySelector(".tab-group-count");t&&(t.textContent=this.tabIds.size)}toJSON(){return{id:this.id,name:this.name,color:this.color,tabIds:Array.from(this.tabIds),collapsed:this.collapsed}}on(t,e){this._events||(this._events={}),this._events[t]||(this._events[t]=[]),this._events[t].push(e)}emit(t,...e){if(!(!this._events||!this._events[t]))for(const s of this._events[t])s(...e)}}function B(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function p(o,t){try{return localStorage.setItem(o,JSON.stringify(t)),!0}catch(e){return console.error("Error saving to storage:",e),!1}}function y(o,t=null){try{const e=localStorage.getItem(o);return e?JSON.parse(e):t}catch(e){return console.error("Error loading from storage:",e),t}}function M(o,t){let e;return function(...i){const r=()=>{clearTimeout(e),o(...i)};clearTimeout(e),e=setTimeout(r,t)}}function S(o){try{const t=new URL(o);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}function A(o){return/^https?:\/\//i.test(o)?o:`https://${o}`}function w(o){try{const t=new URL(o);return`${t.protocol}//${t.host}/favicon.ico`}catch{return""}}const m={TABS:"browser_tabs",GROUPS:"browser_tab_groups",WINDOW_STATE:"browser_window_state"},b="default-group";class C{constructor(){this.tabs=new Map,this.groups=new Map,this.activeTabId=null,this.activeGroupId=b,this.tabCounter=0,this.draggedTab=null,this.tabTemplate=document.getElementById("tab-template"),this.tabsContainer=document.getElementById("tabs"),this.appContainer=document.getElementById("app"),this.groupsContainer=document.getElementById("tab-groups"),this.createGroup("Default","#4a90e2",b),this.loadState(),window.addEventListener("beforeunload",()=>this.saveState()),this.createTab=this.createTab.bind(this),this.closeTab=this.closeTab.bind(this),this.activateTab=this.activateTab.bind(this),this.getActiveTab=this.getActiveTab.bind(this),this.handleDragStart=this.handleDragStart.bind(this),this.handleDragOver=this.handleDragOver.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleDragEnd=this.handleDragEnd.bind(this);const t=document.getElementById("new-tab");t&&t.addEventListener("click",()=>this.createTab());const e=document.getElementById("tabs");e&&(e.addEventListener("dragover",this.handleDragOver),e.addEventListener("drop",this.handleDrop),e.addEventListener("dragend",this.handleDragEnd))}async createTab(t="about:blank",{activate:e=!0}={}){const s=`tab-${++this.tabCounter}`,i=new I(s,t);return i.on("close",r=>this.closeTab(r)),i.on("activate",r=>this.activateTab(r)),i.createElements(),this.tabs.set(s,i),e&&await this.activateTab(s),i}closeTab(t){const e=this.tabs.get(t);if(!e)return;if(this.tabs.size<=1)return this.createTab();const s=e.isActive,i=Array.from(this.tabs.keys()).indexOf(t);if(e.destroy(),this.tabs.delete(t),s){const r=Array.from(this.tabs.keys())[Math.min(i,this.tabs.size-1)];r&&this.activateTab(r)}}async activateTab(t){const e=this.tabs.get(t);if(!(!e||e.isActive)){if(this.activeTabId){const s=this.tabs.get(this.activeTabId);s&&(s.isActive=!1,s.updateUI())}return e.isActive=!0,this.activeTabId=t,e.updateUI(),e.webview&&e.webview.focus(),e}}getActiveTab(){return this.activeTabId?this.tabs.get(this.activeTabId):null}getTab(t){return this.tabs.get(t)}getAllTabs(){return Array.from(this.tabs.values())}getTabCount(){return this.tabs.size}closeAllTabs(){for(const t of this.tabs.values())t.destroy();return this.tabs.clear(),this.activeTabId=null,this.createTab()}getTabIndex(t){return Array.from(this.tabs.keys()).indexOf(t)}handleDragStart(t,e){this.draggedTab=e,t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e),t.target.classList.add("dragging");const s=t.target.getBoundingClientRect(),i=t.target.cloneNode(!0);i.style.position="absolute",i.style.top="-1000px",i.style.width=`${s.width}px`,document.body.appendChild(i),t.dataTransfer.setDragImage(i,s.width/2,s.height/2),setTimeout(()=>document.body.removeChild(i),0)}handleDragOver(t){t.preventDefault(),t.dataTransfer.dropEffect="move";const e=t.target.closest(".tab"),s=document.getElementById("new-tab");if(!e||e===s){s&&s.classList.add("drag-over");return}document.querySelectorAll(".tab").forEach(n=>{n.classList.remove("drag-over-left","drag-over-right")});const i=e.getBoundingClientRect(),a=t.clientX-i.left<i.width/2;e.classList.add(a?"drag-over-left":"drag-over-right")}handleDrop(t){t.preventDefault();const e=t.target.closest(".tab"),s=document.getElementById("new-tab");if(document.querySelectorAll(".tab").forEach(l=>{l.classList.remove("drag-over","drag-over-left","drag-over-right")}),!this.draggedTab)return;if((!e||e===s)&&s){this.moveTabToEnd(this.draggedTab);return}const i=e==null?void 0:e.dataset.tabId;if(!i||i===this.draggedTab)return;const r=e.getBoundingClientRect(),n=t.clientX-r.left<r.width/2;this.moveTabRelativeTo(this.draggedTab,i,n?"before":"after")}handleDragEnd(t){document.querySelectorAll(".tab").forEach(e=>{e.classList.remove("dragging","drag-over","drag-over-left","drag-over-right")}),this.draggedTab=null}moveTabRelativeTo(t,e,s="after"){if(t===e)return;const i=this.tabs.get(t),r=this.tabs.get(e);if(!i||!r)return;this.tabs.delete(t);const n=Array.from(this.tabs.keys()).indexOf(e);let l=s==="before"?n:n+1;const d=new Map;let u=!1;Array.from(this.tabs.entries()).forEach(([v,f],h)=>{h===l&&(d.set(t,i),u=!0),d.set(v,f)}),u||d.set(t,i),this.tabs=d,this.updateTabOrderInDOM()}moveTabToEnd(t){const e=this.tabs.get(t);e&&(this.tabs.delete(t),this.tabs.set(t,e),this.updateTabOrderInDOM())}updateTabOrderInDOM(){const t=document.getElementById("tabs");if(!t)return;const e=Array.from(t.querySelectorAll(".tab:not(#new-tab)")),s=[];this.tabs.forEach((r,a)=>{const n=e.find(l=>l.dataset.tabId===a);n&&s.push(n)});const i=document.getElementById("new-tab");s.forEach(r=>{t.insertBefore(r,i)})}activateNextTab(){if(!this.activeTabId||this.tabs.size<=1)return;const e=(this.getTabIndex(this.activeTabId)+1)%this.tabs.size,s=Array.from(this.tabs.keys())[e];s&&this.activateTab(s)}activatePreviousTab(){if(!this.activeTabId||this.tabs.size<=1)return;const e=(this.getTabIndex(this.activeTabId)-1+this.tabs.size)%this.tabs.size,s=Array.from(this.tabs.keys())[e];s&&this.activateTab(s)}createGroup(t,e,s){const i=s||B(),r=new L(i,t,e);if(r.on("tabAdded",this.handleTabAddedToGroup.bind(this)),r.on("tabRemoved",this.handleTabRemovedFromGroup.bind(this)),r.on("close",this.handleGroupClose.bind(this)),r.on("toggle",this.handleGroupToggle.bind(this)),r.on("rename",this.handleGroupRename.bind(this)),this.groupsContainer){const a=r.createElements();this.groupsContainer.appendChild(a)}return this.groups.set(i,r),this.emit("groupCreated",{groupId:i,name:t,color:e}),r}removeGroup(t,e=!0){if(t===b){console.warn("Cannot remove the default group");return}const s=this.groups.get(t);s&&(e&&Array.from(s.tabIds).forEach(r=>{this.moveTabToGroup(r,b)}),s.element&&s.element.parentNode&&s.element.remove(),this.groups.delete(t),this.emit("groupRemoved",{groupId:t}),this.activeGroupId===t&&this.activateGroup(b))}moveTabToGroup(t,e){const s=this.tabs.get(t),i=this.groups.get(e);if(!(!s||!i)){if(s.groupId){const r=this.groups.get(s.groupId);r==null||r.removeTab(t)}s.groupId=e,i.addTab(t),s.element&&i.tabsContainer&&i.tabsContainer.appendChild(s.element),this.emit("tabGroupChanged",{tabId:t,groupId:e})}}activateGroup(t){this.groups.has(t)&&(this.activeGroupId=t,this.groups.forEach((e,s)=>{var i;(i=e.element)==null||i.classList.toggle("active",s===t)}),this.emit("groupActivated",{groupId:t}))}handleTabAddedToGroup({groupId:t,tabId:e}){var r;const s=this.groups.get(t),i=this.tabs.get(e);s&&i&&((r=i.element)==null||r.setAttribute("data-group-id",t),s.tabsContainer&&i.element&&s.tabsContainer.appendChild(i.element))}handleTabRemovedFromGroup({groupId:t,tabId:e}){var i;const s=this.tabs.get(e);s&&((i=s.element)==null||i.removeAttribute("data-group-id"))}handleGroupClose({groupId:t}){this.removeGroup(t)}handleGroupToggle({groupId:t,collapsed:e}){const s=this.groups.get(t);s&&(s.tabsContainer.style.display=e?"none":"block")}handleGroupRename({groupId:t,oldName:e,newName:s}){const i=this.groups.get(t);i&&i.nameElement&&(i.nameElement.textContent=s)}saveState(){const t=Array.from(this.tabs.entries()).map(([i,r])=>({id:i,url:r.url,title:r.title,favicon:r.favicon,groupId:r.groupId||b,active:i===this.activeTabId})),e=Array.from(this.groups.entries()).map(([i,r])=>({id:i,name:r.name,color:r.color,collapsed:r.collapsed,tabIds:Array.from(r.tabIds)})),s={activeTabId:this.activeTabId,activeGroupId:this.activeGroupId,version:1};p(m.TABS,t),p(m.GROUPS,e),p(m.WINDOW_STATE,s),this.emit("stateSaved")}async loadState(){var i,r;const t=y(m.TABS,[]),e=y(m.GROUPS,[]),s=y(m.WINDOW_STATE,{});e.forEach(a=>{const n=this.createGroup(a.name,a.color,a.id);a.collapsed&&n.toggle()});for(const a of t){const n=await this.createTab(a.url,{activate:!1,groupId:a.groupId});if(n){n.title=a.title||"New Tab",n.favicon=a.favicon||"";const l=(i=n.element)==null?void 0:i.querySelector(".tab-title"),d=(r=n.element)==null?void 0:r.querySelector(".tab-favicon");l&&(l.textContent=n.title),d&&n.favicon&&(d.src=n.favicon)}}s.activeTabId&&this.tabs.has(s.activeTabId)&&this.activateTab(s.activeTabId),s.activeGroupId&&this.groups.has(s.activeGroupId)?this.activateGroup(s.activeGroupId):this.activateGroup(b),this.emit("stateLoaded")}}class D{constructor(t){this.tabManager=t,this.addressBar=document.getElementById("address-bar"),this.backButton=document.getElementById("back"),this.forwardButton=document.getElementById("forward"),this.reloadButton=document.getElementById("reload"),this.homeButton=document.getElementById("home"),this.initializeEventListeners()}initializeEventListeners(){this.backButton&&this.backButton.addEventListener("click",()=>this.goBack()),this.forwardButton&&this.forwardButton.addEventListener("click",()=>this.goForward()),this.reloadButton&&this.reloadButton.addEventListener("click",()=>this.reload()),this.homeButton&&this.homeButton.addEventListener("click",()=>this.goHome()),this.addressBar&&(this.addressBar.addEventListener("keydown",t=>{t.key==="Enter"&&this.navigateTo(this.addressBar.value)}),this.tabManager.on("tabActivated",t=>{t&&this.updateNavigationState(t)}))}async navigateTo(t,{fromHistory:e=!1}={}){if(!t||typeof t!="string")return;const s=this.tabManager.getActiveTab();if(!s||!s.webview)return;let i=t.trim();if(i){if(i===""||i==="about:home"){s.webview.src="about:home",this.updateNavigationState(s);return}if(i.startsWith("about:")){s.webview.src=i,this.updateNavigationState(s);return}!S(i)&&!i.startsWith("about:")?i=`https://www.google.com/search?q=${encodeURIComponent(i)}`:i.match(/^[a-zA-Z]+:\/\//)||(i=A(i));try{if(!e){const r=new CustomEvent("browser-event",{detail:{type:"navigationStarted",data:{url:i,transitionType:"typed",timestamp:Date.now(),tabId:s.id}}});document.dispatchEvent(r)}s.webview.src=i,this.addressBar.value=i,s.url=i,s.title="Loading...",s.updateUI(),s._hasLoadListener||(s.webview.addEventListener("did-finish-load",()=>{s.title=s.webview.getTitle()||new URL(s.url).hostname||s.url,s.updateUI();const r=new CustomEvent("browser-event",{detail:{type:"navigationCompleted",data:{url:s.url,title:s.title,favicon:s.webview.getFavicon()||"",tabId:s.id,timestamp:Date.now()}}});document.dispatchEvent(r)}),s._hasLoadListener=!0)}catch(r){console.error("Navigation error:",r);const a=new CustomEvent("browser-event",{detail:{type:"navigationError",data:{url:i,error:r.message,tabId:s==null?void 0:s.id,timestamp:Date.now()}}});document.dispatchEvent(a)}}}async goBack(){const t=this.tabManager.getActiveTab();if(!t||!t.webview)return!1;if(t.webview.canGoBack()){const e=new CustomEvent("browser-event",{detail:{type:"navigationStarted",data:{url:t.url,transitionType:"back_forward",timestamp:Date.now(),tabId:t.id}}});return document.dispatchEvent(e),t.webview.goBack(),this.updateNavigationState(t),!0}return!1}async goForward(){const t=this.tabManager.getActiveTab();if(!t||!t.webview)return!1;if(t.webview.canGoForward()){const e=new CustomEvent("browser-event",{detail:{type:"navigationStarted",data:{url:t.url,transitionType:"back_forward",timestamp:Date.now(),tabId:t.id}}});return document.dispatchEvent(e),t.webview.goForward(),this.updateNavigationState(t),!0}return!1}async reload(){const t=this.tabManager.getActiveTab();if(!t||!t.webview)return;const e=new CustomEvent("browser-event",{detail:{type:"navigationReload",data:{url:t.url,timestamp:Date.now(),tabId:t.id}}});document.dispatchEvent(e),t.webview.reload(),this.updateNavigationState(t)}async goHome(){await this.navigateTo("about:home",{fromHistory:!0})}updateNavigationState(t){t&&(this.addressBar&&(this.addressBar.value=t.url||""),this.backButton&&(this.backButton.disabled=!t.canGoBack),this.forwardButton&&(this.forwardButton.disabled=!t.canGoForward))}getCurrentUrl(){const t=this.tabManager.getActiveTab();return t?t.url:""}getCurrentTitle(){const t=this.tabManager.getActiveTab();return t?t.title:""}}const T="browser_history",E=1e4,g={TYPED:"typed",LINK:"link"};class x{constructor(t){this.eventBus=t,this.history=new Map,this.urlToId=new Map,this.chronologicalOrder=[],this.loadHistory(),this.setupEventListeners(),setInterval(()=>this.saveHistory(),3e4),window.addEventListener("beforeunload",()=>this.saveHistory())}setupEventListeners(){this.eventBus.subscribe("navigationStarted",t=>{this.addHistoryItem(t.url,t.title||"Loading...",t.transitionType||g.TYPED)}),this.eventBus.subscribe("navigationCompleted",t=>{this.updateHistoryItem(t.url,t.title,t.favicon)}),this.eventBus.subscribe("tabActivated",t=>{t.tab&&t.tab.url&&this.recordVisit(t.tab.url)})}addHistoryItem(t,e="",s=g.TYPED,i=""){if(!t||t.startsWith("about:"))return;const r=Date.now();let a;const n=this.urlToId.get(t);if(n&&this.history.has(n)){a=this.history.get(n),a.visitCount++,a.lastVisitTime=r,a.title=e||a.title,a.favicon=i||a.favicon,s===g.TYPED&&(a.typedCount=(a.typedCount||0)+1);const l=this.chronologicalOrder.indexOf(n);l>-1&&this.chronologicalOrder.splice(l,1),this.chronologicalOrder.push(n)}else{const l=B();a={id:l,url:t,title:e||t,favicon:i||"",visitCount:1,lastVisitTime:r,typedCount:s===g.TYPED?1:0,transitionType:s},this.history.set(l,a),this.urlToId.set(t,l),this.chronologicalOrder.push(l)}return this.trimHistory(),this.eventBus.publish("historyItemAdded",{item:a}),a}updateHistoryItem(t,e,s){const i=this.urlToId.get(t);if(!i||!this.history.has(i))return;const r=this.history.get(i);e&&(r.title=e),s&&(r.favicon=s),this.eventBus.publish("historyItemUpdated",{item:r})}recordVisit(t){const e=this.urlToId.get(t);if(e&&this.history.has(e)){const s=this.history.get(e);s.lastVisitTime=Date.now()}}getHistory(t=100){return this.chronologicalOrder.slice(-t).reverse().map(e=>this.history.get(e)).filter(Boolean)}searchHistory(t,e=50){if(!t)return this.getHistory(e);const s=t.toLowerCase(),i=[];for(const r of this.history.values())if((r.title.toLowerCase().includes(s)||r.url.toLowerCase().includes(s))&&i.push(r),i.length>=e)break;return i.sort((r,a)=>{const n=r.visitCount*.3+r.lastVisitTime/1e6*.7;return a.visitCount*.3+a.lastVisitTime/1e6*.7-n})}getMostVisited(t=10){return Array.from(this.history.values()).sort((e,s)=>s.visitCount-e.visitCount).slice(0,t)}getRecentlyVisited(t=10){return this.getHistory(t)}removeHistoryItem(t){const e=this.history.get(t);if(!e)return;this.history.delete(t),this.urlToId.delete(e.url);const s=this.chronologicalOrder.indexOf(t);s>-1&&this.chronologicalOrder.splice(s,1),this.eventBus.publish("historyItemRemoved",{id:t,item:e})}clearHistory(){this.history.clear(),this.urlToId.clear(),this.chronologicalOrder=[],this.saveHistory(),this.eventBus.publish("historyCleared")}clearHistoryRange(t,e){const s=[];for(const[i,r]of this.history.entries())r.lastVisitTime>=t&&r.lastVisitTime<=e&&s.push(i);s.forEach(i=>this.removeHistoryItem(i))}getStatistics(){const t=this.history.size,e=Array.from(this.history.values()).reduce((l,d)=>l+d.visitCount,0),s=Date.now(),i=s-24*60*60*1e3,r=s-7*24*60*60*1e3,a=Array.from(this.history.values()).filter(l=>l.lastVisitTime>=i).length,n=Array.from(this.history.values()).filter(l=>l.lastVisitTime>=r).length;return{totalItems:t,totalVisits:e,todayVisits:a,weekVisits:n,oldestVisit:Math.min(...Array.from(this.history.values()).map(l=>l.lastVisitTime)),newestVisit:Math.max(...Array.from(this.history.values()).map(l=>l.lastVisitTime))}}trimHistory(){if(this.chronologicalOrder.length<=E)return;const t=this.chronologicalOrder.length-E;this.chronologicalOrder.splice(0,t).forEach(s=>{const i=this.history.get(s);i&&(this.history.delete(s),this.urlToId.delete(i.url))})}saveHistory(){const t={items:Array.from(this.history.entries()),urlToId:Array.from(this.urlToId.entries()),chronologicalOrder:this.chronologicalOrder,version:1};p(T,t)}loadHistory(){const t=y(T,null);t&&t.version===1&&(this.history=new Map(t.items||[]),this.urlToId=new Map(t.urlToId||[]),this.chronologicalOrder=t.chronologicalOrder||[])}exportHistory(){return Array.from(this.history.values()).map(t=>({url:t.url,title:t.title,visitCount:t.visitCount,lastVisitTime:new Date(t.lastVisitTime).toISOString()}))}importHistory(t){t.forEach(e=>{e.url&&e.title&&this.addHistoryItem(e.url,e.title,g.LINK,e.favicon||"")})}}class F{constructor(t,e){this.historyManager=t,this.eventBus=e,this.isVisible=!1,this.currentView="recent",this.searchQuery="",this.createElement(),this.setupEventListeners()}createElement(){this.element=document.createElement("div"),this.element.className="history-panel",this.element.style.display="none",this.render(),document.body.appendChild(this.element)}render(){const t=this.historyManager.getStatistics();this.element.innerHTML=`
      <div class="history-panel-header">
        <h2>History</h2>
        <button class="history-close-btn" title="Close">√ó</button>
      </div>
      
      <div class="history-controls">
        <div class="history-search">
          <input type="text" class="history-search-input" placeholder="Search history..." value="${this.searchQuery}">
          <button class="history-search-btn">üîç</button>
        </div>
        
        <div class="history-tabs">
          <button class="history-tab ${this.currentView==="recent"?"active":""}" data-view="recent">
            Recent
          </button>
          <button class="history-tab ${this.currentView==="mostVisited"?"active":""}" data-view="mostVisited">
            Most Visited
          </button>
          <button class="history-tab ${this.currentView==="search"?"active":""}" data-view="search">
            Search Results
          </button>
        </div>
        
        <div class="history-actions">
          <button class="history-clear-btn">Clear History</button>
          <button class="history-export-btn">Export</button>
        </div>
      </div>
      
      <div class="history-stats">
        <span>Total: ${t.totalItems} items</span>
        <span>Today: ${t.todayVisits} visits</span>
        <span>This week: ${t.weekVisits} visits</span>
      </div>
      
      <div class="history-content">
        ${this.renderHistoryItems()}
      </div>
    `,this.setupEventListeners()}renderHistoryItems(){let t=[];switch(this.currentView){case"recent":t=this.historyManager.getRecentlyVisited(100);break;case"mostVisited":t=this.historyManager.getMostVisited(50);break;case"search":t=this.historyManager.searchHistory(this.searchQuery,100);break}return t.length===0?'<div class="history-empty">No history items found</div>':`
      <div class="history-list">
        ${t.map(e=>this.renderHistoryItem(e)).join("")}
      </div>
    `}renderHistoryItem(t){const e=new Date(t.lastVisitTime),s=this.formatTime(e);return`
      <div class="history-item" data-id="${t.id}">
        <div class="history-item-favicon">
          <img src="${t.favicon||w(t.url)}" 
               alt="" 
               onerror="this.src='${w(t.url)}'" />
        </div>
        
        <div class="history-item-content">
          <div class="history-item-title">${this.escapeHtml(t.title)}</div>
          <div class="history-item-url">${this.escapeHtml(t.url)}</div>
          <div class="history-item-meta">
            <span class="history-item-time">${s}</span>
            <span class="history-item-visits">${t.visitCount} visit${t.visitCount!==1?"s":""}</span>
            ${t.typedCount?`<span class="history-item-typed">${t.typedCount} typed</span>`:""}
          </div>
        </div>
        
        <div class="history-item-actions">
          <button class="history-item-open" title="Open in current tab">‚Üó</button>
          <button class="history-item-new-tab" title="Open in new tab">‚ßâ</button>
          <button class="history-item-remove" title="Remove from history">√ó</button>
        </div>
      </div>
    `}formatTime(t){const s=new Date-t,i=Math.floor(s/(1e3*60)),r=Math.floor(s/(1e3*60*60)),a=Math.floor(s/(1e3*60*60*24));return i<1?"Just now":i<60?`${i} minute${i!==1?"s":""} ago`:r<24?`${r} hour${r!==1?"s":""} ago`:a<7?`${a} day${a!==1?"s":""} ago`:t.toLocaleDateString()}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}setupEventListeners(){if(!this.element)return;const t=this.element.querySelector(".history-close-btn");t&&t.addEventListener("click",()=>this.hide());const e=this.element.querySelector(".history-search-input");e&&(e.addEventListener("input",a=>{this.searchQuery=a.target.value,(this.currentView==="search"||this.searchQuery)&&(this.currentView="search",this.render())}),e.addEventListener("keydown",a=>{a.key==="Enter"&&(this.currentView="search",this.render())}));const s=this.element.querySelector(".history-search-btn");s&&s.addEventListener("click",()=>{this.currentView="search",this.render()}),this.element.addEventListener("click",a=>{const n=a.target.closest(".history-tab");n&&(this.currentView=n.dataset.view,this.render())}),this.element.addEventListener("click",a=>{const n=a.target.closest(".history-item");if(!n)return;const l=n.dataset.id,d=Array.from(this.historyManager.history.values()).find(u=>u.id===l);d&&(a.target.classList.contains("history-item-open")?(this.eventBus.publish("navigate",{url:d.url}),this.hide()):a.target.classList.contains("history-item-new-tab")?this.eventBus.publish("createTab",{url:d.url}):a.target.classList.contains("history-item-remove")?(this.historyManager.removeHistoryItem(l),this.render()):a.target.closest(".history-item-content")&&(this.eventBus.publish("navigate",{url:d.url}),this.hide()))});const i=this.element.querySelector(".history-clear-btn");i&&i.addEventListener("click",()=>{confirm("Are you sure you want to clear all history? This action cannot be undone.")&&(this.historyManager.clearHistory(),this.render())});const r=this.element.querySelector(".history-export-btn");r&&r.addEventListener("click",()=>{this.exportHistory()}),document.addEventListener("keydown",a=>{a.key==="Escape"&&this.isVisible&&this.hide()}),document.addEventListener("click",a=>{if(this.isVisible&&!this.element.contains(a.target)){const n=document.getElementById("history-button");(!n||!n.contains(a.target))&&this.hide()}})}show(){this.isVisible=!0,this.element.style.display="block",this.render();const t=this.element.querySelector(".history-search-input");t&&t.focus(),this.eventBus.publish("historyPanelOpened")}hide(){this.isVisible=!1,this.element.style.display="none",this.eventBus.publish("historyPanelClosed")}toggle(){this.isVisible?this.hide():this.show()}exportHistory(){const t=this.historyManager.exportHistory(),e=JSON.stringify(t,null,2),s=new Blob([e],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=`browser-history-${new Date().toISOString().split("T")[0]}.json`,i.click(),URL.revokeObjectURL(i.href)}destroy(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}class O{constructor(t,e){this.tabManager=t,this.navigationManager=e,this.addressBar=document.getElementById("address-bar"),this.menuButton=document.getElementById("menu-button"),this.bookmarksButton=document.getElementById("bookmarks-button"),this.historyButton=document.getElementById("history-button"),this.downloadsButton=document.getElementById("downloads-button"),this.settingsButton=document.getElementById("settings-button"),this.walletButton=document.getElementById("wallet-button"),this.walletInfo=null,this.invoke=window.__TAURI__&&window.__TAURI__.core&&window.__TAURI__.core.invoke?window.__TAURI__.core.invoke:null,this.eventBus=this.createEventBus(),this.historyManager=new x(this.eventBus),this.historyPanel=new F(this.historyManager,this.eventBus),this.setupEventListeners(),this.setupContextMenu(),this.setupHistoryIntegration(),this.initializeWalletUI()}setupEventListeners(){var r,a,n,l,d,u,v,f;const t=document.getElementById("new-tab");t&&t.addEventListener("click",()=>this.tabManager.createTab());const e=document.getElementById("new-group");e&&e.addEventListener("click",()=>this.createNewGroup());const s=document.getElementById("address-bar");s&&(s.addEventListener("keydown",h=>{h.key==="Enter"?this.navigationManager.navigateTo(s.value):h.key==="Escape"&&s.blur()}),this.tabManager.on("tabActivated",({tabId:h})=>{const k=this.tabManager.getTab(h);k&&s&&(s.value=k.url||"")})),(r=this.backButton)==null||r.addEventListener("click",()=>this.navigationManager.goBack()),(a=this.forwardButton)==null||a.addEventListener("click",()=>this.navigationManager.goForward()),(n=this.reloadButton)==null||n.addEventListener("click",()=>this.navigationManager.reload()),(l=this.homeButton)==null||l.addEventListener("click",()=>this.navigationManager.goHome()),(d=this.bookmarksButton)==null||d.addEventListener("click",()=>this.showBookmarks()),(u=this.historyButton)==null||u.addEventListener("click",()=>this.showHistory()),(v=this.downloadsButton)==null||v.addEventListener("click",()=>this.showDownloads()),(f=this.settingsButton)==null||f.addEventListener("click",()=>this.showSettings());const i=document.getElementById("go");i==null||i.addEventListener("click",()=>{if(this.addressBar){const h=this.addressBar.value.trim();this.navigationManager.navigateTo(h)}}),document.addEventListener("keydown",this.handleKeyboardShortcuts.bind(this))}async initializeWalletUI(){if(!(!this.walletButton||!this.invoke)){try{await this.refreshWalletInfo()}catch(t){console.error("Failed to get initial wallet info:",t)}this.walletButton.addEventListener("click",async()=>{try{await this.refreshWalletInfo(),this.walletInfo&&this.walletInfo.is_connected?await this.disconnectWallet():await this.connectWallet()}catch(t){console.error("Wallet action failed:",t)}})}}async refreshWalletInfo(){if(this.invoke){try{this.walletInfo=await this.invoke("get_wallet_info")}catch(t){console.error("get_wallet_info failed:",t)}this.updateWalletUI()}}async connectWallet(){if(this.invoke){try{this.walletInfo=await this.invoke("connect_wallet")}catch(t){console.error("connect_wallet failed:",t)}this.updateWalletUI()}}async disconnectWallet(){if(this.invoke){try{await this.invoke("disconnect_wallet"),this.walletInfo=null}catch(t){console.error("disconnect_wallet failed:",t)}this.updateWalletUI()}}updateWalletUI(){if(!this.walletButton)return;const t=this.walletInfo;if(t&&t.is_connected){const e=this.formatAddress(t.address||""),s=t.balance||"";this.walletButton.innerHTML=`
        <div class="wallet-connected">
          <div class="wallet-address">${e}</div>
          <div class="wallet-balance">${s}</div>
        </div>
      `,this.walletButton.className="wallet-button connected",this.walletButton.title=`Connected: ${e}`}else this.walletButton.innerHTML="Connect Wallet",this.walletButton.className="wallet-button disconnected",this.walletButton.title="Wallet"}formatAddress(t){return t?t.length>10?`${t.slice(0,6)}...${t.slice(-4)}`:t:""}setupContextMenu(){this.menuButton&&this.menuButton.addEventListener("click",t=>this.toggleMenu(t)),this.addressBar&&(document.addEventListener("keydown",t=>{(t.ctrlKey&&t.key==="l"||t.altKey&&t.key==="d"||t.key==="F6")&&(t.preventDefault(),this.focusAddressBar())}),this.addressBar.addEventListener("focus",()=>{this.showAddressBarSuggestions()}),document.addEventListener("click",t=>{t.target!==this.addressBar&&this.hideAddressBarSuggestions()}),this.addressBar.addEventListener("input",M(()=>{this.updateAddressBarSuggestions()},200))),this.tabManager.on("tabActivated",t=>{this.updateUIForTab(t)}),this.tabManager.on("tabClosed",()=>{const t=this.tabManager.getActiveTab();t&&this.updateUIForTab(t)})}handleKeyboardShortcuts(t){if(t.ctrlKey&&t.key>="1"&&t.key<="9"){const e=parseInt(t.key)-1,s=this.tabManager.getAllTabs();e<s.length&&(t.preventDefault(),this.tabManager.activateTab(s[e].id))}if(t.ctrlKey&&t.key==="Tab"&&!t.shiftKey&&(t.preventDefault(),this.tabManager.activateNextTab()),t.ctrlKey&&t.shiftKey&&t.key==="Tab"&&(t.preventDefault(),this.tabManager.activatePreviousTab()),(t.ctrlKey||t.metaKey)&&t.key==="t"&&(t.preventDefault(),this.tabManager.createTab()),(t.ctrlKey||t.metaKey)&&t.key==="w"){const e=this.tabManager.getActiveTab();e&&this.tabManager.getTabCount()>1&&(t.preventDefault(),this.tabManager.closeTab(e.id))}(t.key==="F5"||(t.ctrlKey||t.metaKey)&&t.key==="r")&&(t.preventDefault(),this.navigationManager.reload()),t.altKey&&t.key==="ArrowLeft"&&(t.preventDefault(),this.navigationManager.goBack()),t.altKey&&t.key==="ArrowRight"&&(t.preventDefault(),this.navigationManager.goForward())}updateUIForTab(t){if(!t)return;this.addressBar&&(this.addressBar.value=t.url||""),document.title=t.title?`${t.title} - Decentralized Browser`:"Decentralized Browser";const e=document.getElementById("back"),s=document.getElementById("forward");e&&(e.disabled=!t.canGoBack),s&&(s.disabled=!t.canGoForward)}focusAddressBar(){this.addressBar&&(this.addressBar.select(),this.showAddressBarSuggestions())}showAddressBarSuggestions(){console.log("Show address bar suggestions")}hideAddressBarSuggestions(){console.log("Hide address bar suggestions")}updateAddressBarSuggestions(){console.log("Update address bar suggestions")}toggleMenu(t){t.stopPropagation(),console.log("Toggle menu")}showBookmarks(){console.log("Show bookmarks")}showHistory(){this.historyPanel.toggle()}showDownloads(){console.log("Show downloads")}showSettings(){console.log("Show settings")}createEventBus(){const t=new Map;return{subscribe(e,s){t.has(e)||t.set(e,[]),t.get(e).push(s)},unsubscribe(e,s){if(t.has(e)){const i=t.get(e),r=i.indexOf(s);r>-1&&i.splice(r,1)}},publish(e,s){t.has(e)&&t.get(e).forEach(i=>{try{i(s)}catch(r){console.error(`Error in event listener for ${e}:`,r)}})}}}setupHistoryIntegration(){if(this.eventBus.subscribe("navigate",t=>{this.navigationManager.navigateTo(t.url)}),this.eventBus.subscribe("createTab",t=>{this.tabManager.createTab(t.url)}),this.navigationManager){const t=this.navigationManager.navigateTo.bind(this.navigationManager);this.navigationManager.navigateTo=async e=>{this.eventBus.publish("navigationStarted",{url:e,transitionType:"typed"});const s=await t(e),i=this.tabManager.getActiveTab();return i&&this.eventBus.publish("navigationCompleted",{url:i.url,title:i.title,favicon:i.favicon}),s}}if(this.tabManager){const t=this.tabManager.activateTab.bind(this.tabManager);this.tabManager.activateTab=async e=>{const s=await t(e),i=this.tabManager.getTab(e);return i&&this.eventBus.publish("tabActivated",{tab:i}),s}}}}function N(o,t){let e=null;return function(...i){const r=()=>{e=null,o(...i)};e!==null&&clearTimeout(e),e=setTimeout(r,t)}}class H{constructor(t){this.bookmarks=new Map,this.folders=new Map,this.eventBus=t,this.rootFolderId="root",this.initializeRootFolder(),this.loadBookmarks(),this.saveToStorage=N(()=>this.saveBookmarks(),500)}initializeRootFolder(){if(!this.folders.has(this.rootFolderId)){const t={id:this.rootFolderId,name:"Bookmarks",parentId:null,children:[],dateAdded:Date.now(),dateModified:Date.now()};this.folders.set(this.rootFolderId,t)}}loadBookmarks(){try{const t=localStorage.getItem("bookmarks"),e=localStorage.getItem("bookmarkFolders");t&&JSON.parse(t).forEach(i=>{this.bookmarks.set(i.id,i)}),e&&JSON.parse(e).forEach(i=>{this.folders.set(i.id,i)})}catch(t){console.error("Error loading bookmarks:",t)}}saveBookmarks(){try{localStorage.setItem("bookmarks",JSON.stringify(Array.from(this.bookmarks.values()))),localStorage.setItem("bookmarkFolders",JSON.stringify(Array.from(this.folders.values())))}catch(t){console.error("Error saving bookmarks:",t)}}addBookmark(t,e=this.rootFolderId){const s=`bookmark-${Date.now()}`,i={...t,id:s,dateAdded:Date.now()};return this.bookmarks.set(s,i),this.addToFolder(s,e),this.saveToStorage(),this.eventBus.publish("bookmarkAdded",{bookmark:i,parentId:e}),i}removeBookmark(t){if(!this.bookmarks.get(t))return;const s=this.findParent(t);s&&(s.children=s.children.filter(i=>!("id"in i)||i.id!==t),this.updateFolder(s.id,{dateModified:Date.now()})),this.bookmarks.delete(t),this.saveToStorage(),this.eventBus.publish("bookmarkRemoved",{bookmarkId:t})}updateBookmark(t,e){const s=this.bookmarks.get(t);if(!s)return null;const i={...s,...e,dateModified:Date.now()};return this.bookmarks.set(t,i),this.saveToStorage(),this.eventBus.publish("bookmarkUpdated",{bookmark:i}),i}createFolder(t,e=this.rootFolderId){const s=`folder-${Date.now()}`,i={id:s,name:t,parentId:e,children:[],dateAdded:Date.now(),dateModified:Date.now()};return this.folders.set(s,i),this.addToFolder(s,e),this.saveToStorage(),i}removeFolder(t){if(t===this.rootFolderId)throw new Error("Cannot remove the root folder");const e=this.folders.get(t);if(!e)return;e.children.forEach(i=>{"children"in i?this.removeFolder(i.id):this.removeBookmark(i.id)});const s=this.findParent(t);s&&(s.children=s.children.filter(i=>!("id"in i)||i.id!==t),this.updateFolder(s.id,{dateModified:Date.now()})),this.folders.delete(t),this.saveToStorage()}updateFolder(t,e){const s=this.folders.get(t);if(!s)return null;const i={...s,...e,dateModified:Date.now()};return this.folders.set(t,i),this.saveToStorage(),i}getBookmark(t){return this.bookmarks.get(t)||null}getFolder(t){return this.folders.get(t)||null}getRootFolder(){return this.getFolder(this.rootFolderId)}getBookmarksByUrl(t){return Array.from(this.bookmarks.values()).filter(e=>e.url===t)}searchBookmarks(t){const e=[],s=t.toLowerCase();for(const i of this.bookmarks.values())(i.title.toLowerCase().includes(s)||i.url.toLowerCase().includes(s))&&e.push(i);for(const i of this.folders.values())i.name.toLowerCase().includes(s)&&e.push(i);return e}addToFolder(t,e){const s=this.folders.get(e);if(!s)return;const i=this.bookmarks.get(t)||this.folders.get(t);if(!i)return;s.children.some(a=>a.id===t)||(s.children.push(i),s.dateModified=Date.now(),this.saveToStorage())}findItemInFolder(t,e){for(const s of t.children){if(("id"in s,s.id)===e)return s;if("children"in s){const r=this.findItemInFolder(s,e);if(r)return r}}return null}findParent(t){for(const e of this.folders.values())if(this.findItemInFolder(e,t))return e;return null}exportBookmarks(){return JSON.stringify({bookmarks:Array.from(this.bookmarks.values()),folders:Array.from(this.folders.values()),version:1,date:new Date().toISOString()},null,2)}importBookmarks(t){try{const e=JSON.parse(t);if(!e.bookmarks||!e.folders)throw new Error("Invalid bookmarks format");this.bookmarks.clear(),this.folders.clear(),this.initializeRootFolder(),e.folders.forEach(s=>{this.folders.set(s.id,{...s,children:[]})}),e.bookmarks.forEach(s=>{this.bookmarks.set(s.id,s)}),e.folders.forEach(s=>{const i=this.folders.get(s.id);i&&s.children&&(i.children=s.children.map(r=>{const a=("id"in r,r.id);return this.bookmarks.get(a)||this.folders.get(a)||null}).filter(r=>r!==null))}),this.saveToStorage(),this.eventBus.publish("bookmarkAdded",{})}catch(e){throw console.error("Error importing bookmarks:",e),new Error("Failed to import bookmarks")}}}class _{constructor(t,e){if(this.container=document.getElementById(t),!this.container){console.error(`BookmarksBar: Container with id "${t}" not found`);return}this.eventBus=e,this.bookmarkManager=new H(e),this.expandedFolders=new Set,this.isVisible=!1,this.initialize()}initialize(){this.container.classList.add("bookmarks-bar"),this.render(),this.setupEventListeners(),this.eventBus.subscribe("bookmarkAdded",()=>this.render()),this.eventBus.subscribe("bookmarkRemoved",()=>this.render()),this.eventBus.subscribe("bookmarkUpdated",()=>this.render()),this.eventBus.subscribe("folderAdded",()=>this.render()),this.eventBus.subscribe("folderRemoved",()=>this.render()),this.eventBus.subscribe("folderUpdated",()=>this.render())}render(){const t=this.bookmarkManager.getFolder("root");t&&(this.container.innerHTML=`
      <div class="bookmarks-toolbar">
        <button class="bookmarks-button" title="Show bookmarks">
          <span class="bookmarks-icon">‚òÖ</span>
          <span class="bookmarks-text">Bookmarks</span>
        </button>
        <div class="bookmarks-dropdown" style="display: ${this.isVisible?"block":"none"}">
          <div class="bookmarks-header">
            <input type="text" class="bookmarks-search" placeholder="Search bookmarks...">
          </div>
          <div class="bookmarks-list">
            ${this.renderFolder(t,0)}
          </div>
        </div>
      </div>
    `,this.setupEventListeners())}renderFolder(t,e){const s=this.expandedFolders.has(t.id),i=t.children||[];return`
      <div class="bookmark-folder" data-folder-id="${t.id}">
        <div class="folder-header" style="padding-left: ${e*16}px">
          <span class="folder-toggle">${s?"‚ñº":"‚ñ∂"}</span>
          <span class="folder-icon">üìÅ</span>
          <span class="folder-name">${t.name}</span>
        </div>
        <div class="folder-contents" style="display: ${s?"block":"none"}">
          ${i.map(r=>"url"in r?this.renderBookmark(r,e+1):this.renderFolder(this.bookmarkManager.getFolder(r.id),e+1)).join("")}
        </div>
      </div>
    `}renderBookmark(t,e){return`
      <a href="${t.url}" class="bookmark-item" data-bookmark-id="${t.id}" style="padding-left: ${e*16+16}px">
        <img src="${t.favicon||w(t.url)}" class="bookmark-favicon" onerror="this.src='${w(t.url)}'" />
        <span class="bookmark-title">${t.title||t.url}</span>
      </a>
    `}setupEventListeners(){const t=this.container.querySelector(".bookmarks-button");t&&t.addEventListener("click",e=>{e.stopPropagation(),this.toggleDropdown()}),document.addEventListener("click",e=>{this.container.contains(e.target)||this.hideDropdown()}),this.container.addEventListener("click",e=>{const s=e.target.closest(".folder-header");if(!s)return;const i=s.closest(".bookmark-folder"),r=i==null?void 0:i.dataset.folderId;r&&this.toggleFolder(r)}),this.container.addEventListener("click",e=>{const s=e.target.closest(".bookmark-item");if(!s)return;e.preventDefault();const i=s.href;this.eventBus.publish("navigate",{url:i}),this.hideDropdown()})}toggleDropdown(){this.isVisible=!this.isVisible;const t=this.container.querySelector(".bookmarks-dropdown");t&&(t.style.display=this.isVisible?"block":"none")}hideDropdown(){this.isVisible=!1;const t=this.container.querySelector(".bookmarks-dropdown");t&&(t.style.display="none")}toggleFolder(t){this.expandedFolders.has(t)?this.expandedFolders.delete(t):this.expandedFolders.add(t),this.render()}}const c=new C,$=new D(c);new _("bookmarks-container",{subscribe:(o,t)=>{const e=s=>{var i;((i=s.detail)==null?void 0:i.type)===o&&t(s.detail.data)};return document.addEventListener("browser-event",e),()=>document.removeEventListener("browser-event",e)},publish:(o,t)=>{document.dispatchEvent(new CustomEvent("browser-event",{detail:{type:o,data:t}}))}});const V=new O(c,$);document.addEventListener("DOMContentLoaded",async()=>{await c.createTab("about:home"),V.initializeEventListeners(),document.addEventListener("keydown",o=>{if((o.ctrlKey||o.metaKey)&&o.key==="t"&&(o.preventDefault(),c.createTab("about:home")),(o.ctrlKey||o.metaKey)&&o.key==="w"){o.preventDefault();const t=c.getActiveTab();t&&c.tabs.length>1&&c.closeTab(t.id)}if(o.ctrlKey&&o.key==="Tab"&&(o.preventDefault(),c.activateNextTab()),o.ctrlKey&&o.shiftKey&&o.key==="Tab"&&(o.preventDefault(),c.activatePreviousTab()),o.ctrlKey&&o.key>="1"&&o.key<="9"){const t=parseInt(o.key)-1;t<c.tabs.length&&(o.preventDefault(),c.activateTab(c.tabs[t].id))}})});
